<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Elytron: Dynamic client SSL context that automatically delegates to different SSLContexts based on the host and port of the peer</title>
    <script src="/wildfly-elytron/assets/javascript/highlight.pack.js" type="text/javascript"></script>

    <link rel="shortcut icon" type="image/png" href="/wildfly-elytron/favicon.ico">
    <link rel="stylesheet" href="http://fonts.googleapis.com/css?family=Roboto:300,400,500,700" type="text/css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    <!-- We override the colours from this theme manually -->
    <link rel="stylesheet" href="https://code.getmdl.io/1.3.0/material.indigo-pink.min.css">
    <link rel="stylesheet" href="/wildfly-elytron/assets/css/styles.css">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.1.0/css/all.css" integrity="sha384-lKuwvrZot6UHsBSfcMvOkWwlCMgc0TaWr+30HWe3a4ltaBwTZhyTEggF5tJv8tbt" crossorigin="anonymous">
    <script src="/wildfly-elytron/assets/javascript/hl.js" type="text/javascript"></script>
    <link rel="alternate" type="application/rss+xml"  href="/wildfly-elytron/feed.xml" title="WildFly Elytron">
    <script defer src="https://code.getmdl.io/1.3.0/material.min.js"></script>

    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-135301155-1"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'UA-135301155-1');
    </script>
    <!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Dynamic client SSL context that automatically delegates to different SSLContexts based on the host and port of the peer | WildFly Elytron</title>
<meta name="generator" content="Jekyll v4.3.3" />
<meta property="og:title" content="Dynamic client SSL context that automatically delegates to different SSLContexts based on the host and port of the peer" />
<meta name="author" content="Diana Krepinska Vilkolakova" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="WildFly 32 running at a community stability level or lower includes the ability to configure the dynamic SSL context. This dynamic SSL context delegates to other instances of SSL contexts that are selected based on the host and port of the peer." />
<meta property="og:description" content="WildFly 32 running at a community stability level or lower includes the ability to configure the dynamic SSL context. This dynamic SSL context delegates to other instances of SSL contexts that are selected based on the host and port of the peer." />
<link rel="canonical" href="https://wildfly-security.github.io/wildfly-elytron/blog/dynamic-client-ssl-context/" />
<meta property="og:url" content="https://wildfly-security.github.io/wildfly-elytron/blog/dynamic-client-ssl-context/" />
<meta property="og:site_name" content="WildFly Elytron" />
<meta property="og:image" content="https://wildfly-security.github.io/wildfly-elytron/assets/images/wildfly-elytron-logo.jpg" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2024-05-07T00:00:00+00:00" />
<meta name="twitter:card" content="summary_large_image" />
<meta property="twitter:image" content="https://wildfly-security.github.io/wildfly-elytron/assets/images/wildfly-elytron-logo.jpg" />
<meta property="twitter:title" content="Dynamic client SSL context that automatically delegates to different SSLContexts based on the host and port of the peer" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Diana Krepinska Vilkolakova"},"dateModified":"2024-05-07T00:00:00+00:00","datePublished":"2024-05-07T00:00:00+00:00","description":"WildFly 32 running at a community stability level or lower includes the ability to configure the dynamic SSL context. This dynamic SSL context delegates to other instances of SSL contexts that are selected based on the host and port of the peer.","headline":"Dynamic client SSL context that automatically delegates to different SSLContexts based on the host and port of the peer","image":"https://wildfly-security.github.io/wildfly-elytron/assets/images/wildfly-elytron-logo.jpg","mainEntityOfPage":{"@type":"WebPage","@id":"https://wildfly-security.github.io/wildfly-elytron/blog/dynamic-client-ssl-context/"},"url":"https://wildfly-security.github.io/wildfly-elytron/blog/dynamic-client-ssl-context/"}</script>
<!-- End Jekyll SEO tag -->

</head>
<body>


<!-- Always shows a header, even in smaller screens. -->
<div class="mdl-layout mdl-js-layout mdl-layout--fixed-header">
    <header class="mdl-layout__header mdl-layout__header--scroll">
        <div class="mdl-layout__header-row ">
            <!-- Title -->
            <span class="mdl-layout-title"><h3>Wild<strong>Fly</strong>  Elytron</h3></span>
            <!-- Add spacer, to align navigation to the right -->
            <div class="mdl-layout-spacer"></div>
            <nav class="mdl-navigation mdl-layout--large-screen-only">
                
                    
                    
                    
                    
                         <a class="mdl-navigation__link highlight-button Open Source Day-menuitem" href="/wildfly-elytron/OSD/">Open Source Day</a>
                    
                
                    
                    
                    
                    
                         <a class="mdl-navigation__link highlight-button Hacktoberfest-menuitem" href="/wildfly-elytron/hacktoberfest/">Hacktoberfest</a>
                    
                
                    
                    
                    
                    
                         <a class="mdl-navigation__link Home-menuitem" href="/wildfly-elytron/">Home</a>
                    
                
                    
                    
                    
                    
                         <a class="mdl-navigation__link Guides-menuitem" href="/wildfly-elytron/guides/">Guides</a>
                    
                
                    
                    
                    
                    
                         <a class="mdl-navigation__link Docs-menuitem" href="/wildfly-elytron/docs/">Docs</a>
                    
                
                    
                    
                    
                    
                         <a class="mdl-navigation__link Community-menuitem" href="/wildfly-elytron/community/">Community</a>
                    
                
                    
                    
                    
                    
                         <a class="mdl-navigation__link mdl-navigation__link--current Blog-menuitem" href="/wildfly-elytron/blog/">Blog</a>
                    
                
                    
                    
                    
                    
                         <a class="mdl-navigation__link GitHub-menuitem" href="https://github.com/wildfly-security/wildfly-elytron">GitHub</a>
                    
                
                    
                    
                    
                    
                         <a class="mdl-navigation__link CVE Reporting-menuitem" href="/wildfly-elytron/security/">CVE Reporting</a>
                    
                
            </nav>
        </div>
    </header>
    <div class="mdl-layout__drawer">
        <div class="side-drawer-logo-container"><h3>Wild<strong>Fly</strong>  Elytron</h3></div>
        <nav class="mdl-navigation">
            
            
            
            
            
                <a class="mdl-navigation__link highlight-sidebar Open Source Day-menuitem" href="/wildfly-elytron/OSD/">Open Source Day</a>
            
            
            
            
            
            
                <a class="mdl-navigation__link highlight-sidebar Hacktoberfest-menuitem" href="/wildfly-elytron/hacktoberfest/">Hacktoberfest</a>
            
            
            
            
            
            
                <a class="mdl-navigation__link Home-menuitem" href="/wildfly-elytron/">Home</a>
            
            
            
            
            
            
                <a class="mdl-navigation__link Guides-menuitem" href="/wildfly-elytron/guides/">Guides</a>
            
            
            
            
            
            
                <a class="mdl-navigation__link Docs-menuitem" href="/wildfly-elytron/docs/">Docs</a>
            
            
            
            
            
            
                <a class="mdl-navigation__link Community-menuitem" href="/wildfly-elytron/community/">Community</a>
            
            
            
            
            
            
                <a class="mdl-navigation__link mdl-navigation__link--current Blog-menuitem" href="/wildfly-elytron/blog/">Blog</a>
            
            
            
            
            
            
                <a class="mdl-navigation__link GitHub-menuitem" href="https://github.com/wildfly-security/wildfly-elytron">GitHub</a>
            
            
            
            
            
            
                <a class="mdl-navigation__link CVE Reporting-menuitem" href="/wildfly-elytron/security/">CVE Reporting</a>
            
            
            <!-- mdl-navigation__link--current -->
        </nav>
    </div>
    <main class="mdl-layout__content">
        <div class="page-content">
            
            <div class="content">
                <div class="post-page grid-wrapper">
  <div class="grid__item width-12-12 width-12-12-m doc-content">
    <h1>Dynamic client SSL context that automatically delegates to different SSLContexts based on the host and port of the peer</h1>
    <div class="grid-wrapper">
      <div class="grid__item width-8-12 width-12-12-m byline-wrapper">
        
        
          <img class="headshot" src="https://www.gravatar.com/avatar/4336bee4b72f539ef5f8cc0d2c6026f5">
        
        <p class="byline">
          By <a href="https://github.com/Skyllarr">Diana Krepinska Vilkolakova</a> | May 07, 2024
          <br>
          
            
              <a style="font-size: 0.9em;" href="/wildfly-elytron/blog/tag/ssl"> #ssl</a>
            
              <a style="font-size: 0.9em;" href="/wildfly-elytron/blog/tag/tls"> #tls</a>
            
              <a style="font-size: 0.9em;" href="/wildfly-elytron/blog/tag/context"> #context</a>
            
              <a style="font-size: 0.9em;" href="/wildfly-elytron/blog/tag/dynamic"> #dynamic</a>
            
              <a style="font-size: 0.9em;" href="/wildfly-elytron/blog/tag/authentication"> #authentication</a>
            
              <a style="font-size: 0.9em;" href="/wildfly-elytron/blog/tag/reverse"> #reverse</a>
            
              <a style="font-size: 0.9em;" href="/wildfly-elytron/blog/tag/proxy"> #proxy</a>
            
          
        </p>
      </div>
      
      <div class="grid__item width-4-12 width-12-12-m"><div class="share-page">
  <a class="share-linkedin" href="https://www.linkedin.com/shareArticle?mini=true&url=https://wildfly-security.github.io/wildfly-elytron/blog/dynamic-client-ssl-context/&title=Dynamic client SSL context that automatically delegates to different SSLContexts based on the host and port of the peer" rel="nofollow" target="_blank" title="Share on LinkedIn">
    <i class="fab fa-linkedin"></i>
  </a>
  <a class="share-twitter" href="https://twitter.com/intent/tweet?text=Dynamic client SSL context that automatically delegates to different SSLContexts based on the host and port of the peer&url=https://wildfly-security.github.io/wildfly-elytron/blog/dynamic-client-ssl-context/&via=WildFlyAS&related=WildFlyAS" rel="nofollow" target="_blank" title="Share on Twitter">
    <i class="fab fa-twitter-square"></i>
  </a>
  <a class="share-facebook" href="https://facebook.com/sharer.php?u=https://wildfly-security.github.io/wildfly-elytron/blog/dynamic-client-ssl-context/" rel="nofollow" target="_blank" title="Share on Facebook">
    <i class="fab fa-facebook-square"></i>
  </a>
  <a class="share-reddit" href="http://www.reddit.com/submit?url=https://wildfly-security.github.io/wildfly-elytron/blog/dynamic-client-ssl-context/" onclick="window.open(this.href, 'pop-up', 'left=20,top=20,width=900,height=500,toolbar=1,resizable=0'); return false;" title="Share on Reddit" >
    <i class="fab fa-reddit-square"></i>
  </a>
  <a class="share-email" href="mailto:?subject=Dynamic client SSL context that automatically delegates to different SSLContexts based on the host and port of the peer&amp;body=Dynamic client SSL context that automatically delegates to different SSLContexts based on the host and port of the peer https://wildfly-security.github.io/wildfly-elytron/blog/dynamic-client-ssl-context/" title="Share via Email" >
    <i class="fas fa-envelope-square"></i>
  </a>
</div>
</div>
      <div class="grid__item width-12-12">
          <div class="paragraph">
<p>WildFly 32 running at a <a href="https://docs.wildfly.org/32/Admin_Guide.html#Feature_stability_levels">community stability level</a> or lower includes the ability to configure the dynamic SSL context. This dynamic SSL context delegates to other instances of SSL contexts that are selected based on the host and port of the peer.</p>
</div>
<div id="toc" class="toc">
<div id="toctitle" class="title"></div>
<ul class="sectlevel1">
<li><a href="#prerequisites">Prerequisites</a></li>
<li><a href="#new-dynamic-client-ssl-context-resource">New dynamic-client-ssl-context resource</a></li>
<li><a href="#example-configuration-on-the-server-side">Example configuration on the server side</a></li>
<li><a href="#example-use-on-the-client-side">Example use on the client side</a></li>
<li><a href="#example-using-reverse-proxies">Example using reverse proxies</a>
<ul class="sectlevel3">
<li><a href="#testing-the-example">Testing the example</a></li>
</ul>
</li>
<li><a href="#summary">Summary</a></li>
<li><a href="#resources">Resources</a></li>
</ul>
</div>
<div class="sect1">
<h2 id="prerequisites"><a class="anchor" href="#prerequisites"></a>Prerequisites</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To follow along with this guide, you will need:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Roughly 15 minutes</p>
</li>
<li>
<p>WildFly 32 or newer</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="new-dynamic-client-ssl-context-resource"><a class="anchor" href="#new-dynamic-client-ssl-context-resource"></a>New dynamic-client-ssl-context resource</h2>
<div class="sectionbody">
<div class="paragraph">
<p>WildFly 32 has added a new <code>dynamic-client-ssl-context</code> resource to the elytron subsystem. This new resource has a single attribute <code>authentication-context</code>, which points to the configured <code>authentication-context</code> resource. It can have multiple ssl-contexts configured for different hosts and/or ports. The dynamic client SSL context dynamically delegates to the specific client SSL context that is configured for the host and/or port of the connection.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="example-configuration-on-the-server-side"><a class="anchor" href="#example-configuration-on-the-server-side"></a>Example configuration on the server side</h2>
<div class="sectionbody">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">/subsystem=elytron/authentication-context=ac:add(match-rules=[{match-port=8443,ssl-context=client1-ssl-context},{match-host="www.example.org",ssl-context=client2-ssl-context}, {match-host="www.myhost.org", match-port=443, ssl-context=client3-ssl-context}])

/subsystem=elytron/dynamic-client-ssl-context=dynamicClientSSLContext:add(authentication-context=ac)</code></pre>
</div>
</div>
<div class="paragraph">
<p>The dynamic client SSL context will dynamically switch between different configurations based on the host and port of the peer. In the above configuration, if the hostname of the peer connection is <code>"www.example.org"</code>, then the <code>client2-ssl-context</code> will be used. If another request is made to port <code>8443</code>, then <code>client1-ssl-context</code> will be used. Note that the first matching rule from the given authentication context is always preferred.
If the destination does not match any of the rules, the configured default SSLContext will be used. If it is not configured, then <code>SSLContext.getDefault()</code> will be used.</p>
</div>
<div class="paragraph">
<p>It is also possible to configure this dynamic SSL context to be a <code>default SSL context</code> on the server:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">/subsystem=elytron:write-attribute(name=default-ssl-context,value=dynamicClientSSLContext)
reload</code></pre>
</div>
</div>
<div class="paragraph">
<p>If this is the case, standalone clients in a deployed applications that use the <code>SSLContext.getDefault()</code> will use this dynamic SSL context for their requests.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="example-use-on-the-client-side"><a class="anchor" href="#example-use-on-the-client-side"></a>Example use on the client side</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To use the dynamic client SSL context with the standalone clients, make sure you have the elytron module <code>wildfly-elytron-dynamic-ssl</code> on your classpath. You can then instantiate the <code>org.wildfly.security.dynamic.ssl.DynamicSSLContext</code> as shown below:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">DynamicSSLContext dynamicSSLContext = new DynamicSSLContext();</code></pre>
</div>
</div>
<div class="paragraph">
<p>The DynamicSSLContext instance loads the authentication context from the classpath as is described in the <a href="https://docs.wildfly.org/32/WildFly_Elytron_Security.html#the-default-configuration-approach">elytron client documentation</a>.</p>
</div>
<div class="paragraph">
<p>You can also pass an existing <code>AuthenticationContext</code> instance to the <code>org.wildfly.security.dynamic.ssl.DynamicSSLContextImpl</code> class and use it directly with the DynamicSSLContext: <code>new DynamicSSLContext(new DynamicSSLContextImpl(myAuthenticationContextInstance));</code></p>
</div>
<div class="paragraph">
<p>Same as on the server side, the client configuration can also specify different rules for different SSL contexts. These rules are used by the DynamicSSLContext to select an SSLContext to delegate to.</p>
</div>
<div class="paragraph">
<p>As always, you can use either the programmatic approach to provide the authentication context or the configuration file approach. Below is an example of SSL context rules in the configuration file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">&lt;ssl-context-rules&gt;
    &lt;rule use-ssl-context="client-context1"&gt;
        &lt;match-host name="www.example.org"/&gt;
        &lt;match-port number="443"/&gt;
    &lt;/rule&gt;
    &lt;rule use-ssl-context="client-context2"&gt;
        &lt;match-host name="localhost"/&gt;
        &lt;match-port number="8443"/&gt;
    &lt;/rule&gt;
    &lt;rule use-ssl-context="client-context3"&gt;
        &lt;match-port number="9443"/&gt;
    &lt;/rule&gt;
        &lt;rule use-ssl-context="default-context"&gt;
    &lt;/rule&gt;
&lt;/ssl-context-rules&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note: Since the <code>org.wildfly.security.dynamic.ssl.DynamicSSLContextSPI</code> is an SPI, you can use your own implementation to provide SSL context selection instead of relying on the elytron client.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="example-using-reverse-proxies"><a class="anchor" href="#example-using-reverse-proxies"></a>Example using reverse proxies</h2>
<div class="sectionbody">
<div class="paragraph">
<p>We will use a simple example consisting of a <a href="https://github.com/wildfly-security-incubator/elytron-examples/blob/main/dynamic-ssl-reverse-proxies/configure.cli">configure.cli</a> file. This file configures 2 ports secured with TLS and 2 reverse proxies connecting to these ports.</p>
</div>
<div class="paragraph">
<p>To get the <code>configure.cli</code> file, clone the elytron-examples repository to your local machine:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">git clone git@github.com:wildfly-security-incubator/elytron-examples.git</code></pre>
</div>
</div>
<div class="paragraph">
<p>and navigate to the <code>dynamic-ssl-reverse-proxies</code> directory.</p>
</div>
<div class="paragraph">
<p>Since the community is the default stability, you can start the WildFly server with the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">$WILDFLY_HOME/bin/standalone.sh</code></pre>
</div>
</div>
<div class="paragraph">
<p>Examine the commands in the <code>configure.cli</code> file of the <code>dynamic-ssl-reverse-proxies</code> example. This file configures ports 9443 and 10443 to require a different certificate and truststore to connect. The URL <a href="http://localhost:8080/proxy" class="bare">http://localhost:8080/proxy</a> has been configured as a reverse proxy, forwarding requests to port 9443, where there is a WildFly welcome page. Similarly, the URL <a href="http://localhost:8080/proxy2" class="bare">http://localhost:8080/proxy2</a> forwards requests to port 10443. Finally, the <code>authentication-context</code> and <code>dynamic-client-ssl-context</code> have been configured to associate the ports with the appropriate <code>client-ssl-context</code> resource.</p>
</div>
<div class="paragraph">
<p>Run the <code>configure.cli</code> file to apply the changes to your running WildFly server:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">$WILDFLY_HOME/bin/jboss-cli.sh --connect  --file=configure.cli</code></pre>
</div>
</div>
<div class="sect3">
<h4 id="testing-the-example"><a class="anchor" href="#testing-the-example"></a>Testing the example</h4>
<div class="paragraph">
<p>Try accessing the reverse proxy <a href="http://localhost:8080/proxy" class="bare">http://localhost:8080/proxy</a> and the <a href="http://localhost:8080/proxy2" class="bare">http://localhost:8080/proxy2</a> with your browser. Both of these URLs will successfully return the <code>Welcome to WildFly</code> page.</p>
</div>
<div class="paragraph">
<p>When you accessed the <a href="http://localhost:8080/proxy" class="bare">http://localhost:8080/proxy</a> the reverse proxy forwarded your request to the <a href="https://localhost:9443/" class="bare">https://localhost:9443/</a> URL. This URL requires you to provide a client certificate and to accept the server&#8217;s certificate. The request was successful because the dynamic client SSL context delegated to an appropriate client SSL context that has a requested certificate and truststore configured. If you tried to access the <a href="https://localhost:9443/" class="bare">https://localhost:9443/</a> directly instead, the browser will require you to accept the server&#8217;s certificate and provide a client certificate.</p>
</div>
<div class="paragraph">
<p>Similarly, when you accessed the <a href="http://localhost:8080/proxy2" class="bare">http://localhost:8080/proxy2</a>, the reverse proxy redirected your request to <a href="https://localhost:10443/" class="bare">https://localhost:10443/</a> and dynamic client SSL context delegated to a client SSL context that was configured specifically for the requested port.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="summary"><a class="anchor" href="#summary"></a>Summary</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This blog post explained why and how to configure the dynamic SSL context in both a standalone client and in a WildFly server. See the resources and WildFly documentation for more information.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="resources"><a class="anchor" href="#resources"></a>Resources</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p><a href="https://docs.wildfly.org/32/WildFly_Elytron_Security.html#dynamic-client-sslcontext">Elytron dynamic client SSL context documentation</a></p>
</li>
<li>
<p><a href="https://docs.wildfly.org/32/WildFly_Elytron_Security.html#the-default-configuration-approach">Elytron client discovery</a></p>
</li>
<li>
<p><a href="https://docs.wildfly.org/32/WildFly_Elytron_Security.html#Client_Authentication_with_Elytron_Client">Elytron client authentication documentation</a></p>
</li>
<li>
<p><a href="https://docs.wildfly.org/32/WildFly_Elytron_Security.html#ssl-components">Elytron SSL component summary</a></p>
</li>
</ul>
</div>
</div>
</div>
      </div>
    </div>
  </div>
</div>

            </div>
        </div>
    </main>
</div>
</body>
</html>
